require(dplyr)
require(NPL)
# Importation of the data
data_ms <- read_seg_file(path_.seg)
# Offer the possibility to the user to add a column with the time in ms
if(time_ms != "none"){
data_ms$time <- time_ms
}
# List of plots
ncol_data <- ncol(data_ms)
n_conditions <- (ncol_data-1)/5
plot_list <- list()
index_col_GFP <- grep("GFP", colnames(data_ms))
index_col_Seg <- grep("Seg", colnames(data_ms))
if(time_ms == "none"){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
} else{
if(FWBW == "FW"){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
} else {
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
#geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
}
}
}
return(plot_list)
}
plot_microstates <- function(path_.seg, FWBW = "FW", time_ms = "none", size_hist = 2, palette = "Spectral"){
require(ggplot2)
require(ggpubr)
require(RColorBrewer)
require(readr)
require(dplyr)
require(NPL)
# Importation of the data
data_ms <- read_seg_file(path_.seg)
# Offer the possibility to the user to add a column with the time in ms
if(time_ms != "none"){
data_ms$time <- time_ms
}
# List of plots
ncol_data <- ncol(data_ms)
n_conditions <- (ncol_data-1)/5
plot_list <- list()
index_col_GFP <- grep("GFP", colnames(data_ms))
index_col_Seg <- grep("Seg", colnames(data_ms))
if(time_ms == "none"){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
} else{
if(FWBW == "FW"){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
} else {
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
#geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
}
}
return(plot_list)
}
plot_microstates(path_.seg = path_.seg, time_ms = time_ms)
plot_microstates(path_.seg = path_.seg, time_ms = time_ms, FWBW = "BW")
plot_microstates <- function(path_.seg, vline_onset = FALSE, time_ms = "none", size_hist = 2, palette = "Spectral"){
require(ggplot2)
require(ggpubr)
require(RColorBrewer)
require(readr)
require(dplyr)
require(NPL)
# Importation of the data
data_ms <- read_seg_file(path_.seg)
# Offer the possibility to the user to add a column with the time in ms
if(time_ms != "none"){
data_ms$time <- time_ms
}
# List of plots
ncol_data <- ncol(data_ms)
n_conditions <- (ncol_data-1)/5
plot_list <- list()
index_col_GFP <- grep("GFP", colnames(data_ms))
index_col_Seg <- grep("Seg", colnames(data_ms))
if(time_ms == "none"){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
} else{
if(FWBW == "FW"){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
} else {
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
#geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
}
}
return(plot_list)
}
plot_microstates <- function(path_.seg, vline_onset = FALSE, time_ms = "none", size_hist = 2, palette = "Spectral"){
require(ggplot2)
require(ggpubr)
require(RColorBrewer)
require(readr)
require(dplyr)
require(NPL)
# Importation of the data
data_ms <- read_seg_file(path_.seg)
# Offer the possibility to the user to add a column with the time in ms
if(time_ms != "none"){
data_ms$time <- time_ms
}
# List of plots
ncol_data <- ncol(data_ms)
n_conditions <- (ncol_data-1)/5
plot_list <- list()
index_col_GFP <- grep("GFP", colnames(data_ms))
index_col_Seg <- grep("Seg", colnames(data_ms))
if(time_ms == "none"){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
} else{
if(vline_onset == TRUE){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
} else if (vline_onset == FALSE) {
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
#geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = "GFP amplitude in mv")+
scale_color_brewer(palette = palette)
}
}
}
return(plot_list)
}
plot_microstates(path_.seg = path_.seg, time_ms = time_ms, vline_onset = TRUE)
path_.seg <- "C:/Users/EricM/Desktop/verification topo/Data Cartool/test fitting maps/Fit Maps FW_ICN_5maps/Fit Maps FW_ICN_5maps.Group1.seg"
plot_microstates(path_.seg = path_.seg, time_ms = time_ms, vline_onset = TRUE)
time_ms <- c(seq(-100, 0, by = 4), seq(5,520, by = 4))
plot_microstates(path_.seg = path_.seg, time_ms = time_ms, vline_onset = TRUE)
plot_microstates(path_.seg = path_.seg, time_ms = time_ms, vline_onset = FALSE)
library(devtools)
document()
document()
install_github("EricMenetre/NPL")
library(devtools)
document()
library(devtools)
document()
library(devtools)
document()
library(devtools)
document()
install_github("EricMenetre/NPL")
plot_microstates <- function(path_.seg, vline_onset = FALSE, time_ms = "none", size_hist = 2, palette = "default"){
require(ggplot2)
require(ggpubr)
require(RColorBrewer)
require(readr)
require(dplyr)
require(NPL)
require(readxl)
# Importation of the data
data_ms <- read_seg_file(path_.seg)
# Offer the possibility to the user to add a column with the time in ms
if(time_ms != "none"){
data_ms$time <- time_ms
}
# Definition of the colors
if (palette == "default"){
maps_numbers <- 1:40
colors <- c("darkgreen",      "coral1",
"cornflowerblue",  "chartreuse3",
"cyan4",           "dodgerblue3",
"firebrick3",      "forestgreen",
"darkorange2",     "darkorchid",
"darkred",         "darkseagreen2",
"darkslategray2",  "deeppink3",
"gold2",           "darkolivegreen2",
"darkmagenta",     "deepskyblue2",
"aquamarine3",     "burlywood4",
"cadetblue4",      "blue3",
"darkslateblue",   "gray54",
"lightblue2",      "lightgoldenrod2",
"lightsalmon2",    "mediumpurple2",
"navyblue",        "magenta3",
"steelblue2",      "tan2",
"yellowgreen",     "turquoise4",
"royalblue2",      "red4",
"lightsteelblue2", "plum4",
"mediumvioletred", "mediumseagreen")
color_reference <- data.frame(maps_numbers, colors)
color_reference$colors <- as.character(color_reference$colors)
color_reference$maps_numbers <- as.character(color_reference$maps_numbers)
} else if(palette == "alternative"){
maps_numbers <- 40:1
colors <- c("darkgreen",      "coral1",
"cornflowerblue",  "chartreuse3",
"cyan4",           "dodgerblue3",
"firebrick3",      "forestgreen",
"darkorange2",     "darkorchid",
"darkred",         "darkseagreen2",
"darkslategray2",  "deeppink3",
"gold2",           "darkolivegreen2",
"darkmagenta",     "deepskyblue2",
"aquamarine3",     "burlywood4",
"cadetblue4",      "blue3",
"darkslateblue",   "gray54",
"lightblue2",      "lightgoldenrod2",
"lightsalmon2",    "mediumpurple2",
"navyblue",        "magenta3",
"steelblue2",      "tan2",
"yellowgreen",     "turquoise4",
"royalblue2",      "red4",
"lightsteelblue2", "plum4",
"mediumvioletred", "mediumseagreen")
color_reference <- data.frame(maps_numbers, colors)
color_reference$colors <- as.character(color_reference$colors)
color_reference$maps_numbers <- as.character(color_reference$maps_numbers)
} else {
color_reference <- read_excel(palette)
names(color_reference)[1] <- "maps_numbers"
names(color_reference)[2] <- "colors"
color_reference$colors <- as.character(color_reference$colors)
color_reference$maps_numbers <- as.character(color_reference$maps_numbers)
}
# List of plots
ncol_data <- ncol(data_ms)
n_conditions <- (ncol_data-1)/5
plot_list <- list()
index_col_GFP <- grep("GFP", colnames(data_ms))
index_col_Seg <- grep("Seg", colnames(data_ms))
# Creation of the data frame by extracting the relevant information for each plot and plotting according to the parameters entered as argument.
if(time_ms == "none"){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
maps <- distinct(data_plot, Maps)
maps <- maps%>%filter(!is.na(Maps))%>%arrange(Maps)
maps$Maps <- as.character(maps$Maps)
palette <- maps%>%left_join(color_reference, by = c("Maps" = "maps_numbers"))%>%select(colors)
palette <- palette$colors
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
theme_minimal()+
labs(y = expression(paste("Time in ", mu,"v", sep = "")))+
scale_color_manual(values=palette)
}
} else{
if(vline_onset == TRUE){
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
maps <- distinct(data_plot, Maps)
maps <- maps%>%filter(!is.na(Maps))%>%arrange(Maps)
maps$Maps <- as.character(maps$Maps)
palette <- maps%>%left_join(color_reference, by = c("Maps" = "maps_numbers"))%>%select(colors)
palette <- palette$colors
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = expression(paste("Time in ", mu,"v", sep = "")))+
scale_color_manual(values=palette)
rm(data_plot, maps, palette)
}
} else if (vline_onset == FALSE) {
for(i in 1:n_conditions){
time = as.numeric(simplify2array(data_ms[,"time"]))
GFP = as.numeric(simplify2array(data_ms[,index_col_GFP[i]]))
Seg = as.factor(simplify2array(data_ms[,index_col_Seg[i]]))
data_plot <- data.frame(time,GFP, Seg)
data_plot$Seg[data_plot$Seg == 0] <- NA
data_plot <- data_plot%>%rename(Maps = Seg,
Time = time)
rm(time, GFP, Seg)
maps <- distinct(data_plot, Maps)
maps <- maps%>%filter(!is.na(Maps))%>%arrange(Maps)
maps$Maps <- as.character(maps$Maps)
palette <- maps%>%left_join(color_reference, by = c("Maps" = "maps_numbers"))%>%select(colors)
palette <- palette$colors
plot_list[[i]] <- ggplot(data_plot, aes(x = Time, y = GFP))+
geom_segment(aes(x = Time-0.1, xend = Time+0.1, y = 0, yend = GFP, color = Maps), size = size_hist)+
geom_area(fill = "gray", alpha = 0.2)+
geom_line(col = "black", size = 0.8)+
#geom_vline(xintercept = 0, col = "black", alpha = 0.8, size = 0.7)+
theme_minimal()+
labs(y = expression(paste("Time in ", mu,"v", sep = "")))+
scale_color_manual(values=palette)
}
}
}
#output
return(plot_list)
}
plot_microstates(path_.seg = "read_seg_file__plot_microstates/Fit Maps FW_ICN_5maps.Group1.seg",
vline_onset = TRUE,
time_ms = time_in_ms,
size_hist = 2,
palette = "default")
plot_microstates(path_.seg = "C:/Users/EricM/ownCloud/UNIGE/Packages/tuto_NPL_PKG/read_seg_file__plot_microstates/Fit Maps FW_ICN_5maps.Group1.seg",
vline_onset = TRUE,
time_ms = time_in_ms,
size_hist = 2,
palette = "default")
time_in_ms <- c(seq(-100, 0, by = 4), seq(5,520, by = 4))
plot_microstates(path_.seg = "C:/Users/EricM/ownCloud/UNIGE/Packages/tuto_NPL_PKG/read_seg_file__plot_microstates/Fit Maps FW_ICN_5maps.Group1.seg",
vline_onset = TRUE,
time_ms = time_in_ms,
size_hist = 2,
palette = "default")
library(devtools)
document()
install_github("EricMenetre/NPL")
